"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const sequelize_service_1=require("./sequelize-service");let log=require("npmlog");const TAG="BaseService";class CRUDService{getModels(e){return sequelize_service_1.default.getInstance().models[e]}getSequelize(){return sequelize_service_1.default.getInstance().sequelize}errHandler(e){if(e.name)return{status:!1,errMessage:e.message};throw e}create(e,t){return log.verbose(TAG,`create(): modelName=${e} data=${JSON.stringify(t)}`),this.getModels(e).create(Object.assign(t,{id:null})).then(e=>({status:!0,data:e.get({plain:!0})})).catch(this.errHandler)}read(e,t){return log.verbose(TAG,`read(): modelName=${e} searchClause=${JSON.stringify(t)}`),this.getModels(e).findAll({where:t}).then(e=>({status:!0,data:e.map(e=>e.get({plain:!0}))})).catch(this.errHandler)}readOne(e,t){return this.getModels(e).findOne({where:t}).then(e=>e?{status:!0,data:e.get({plain:!0})}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}rawReadQuery(e){return this.getSequelize().query(e,{type:this.getSequelize().QueryTypes.SELECT}).then(e=>({status:!0,data:e}))}rawReadOneQuery(e){return this.rawReadQuery(e).then(e=>e.status&&e.data?e.data.length?{status:!0,data:e.data[0]}:{status:!1,errMessage:"Data not found!"}:e)}update(e,t,a){return log.verbose(TAG,`update(): modelName=${e} data=${JSON.stringify(t)}`),this.getModels(e).update(t,{where:a}).spread(e=>e>0?{status:!0,data:e}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}delete(e,t){return log.verbose(TAG,`delete(): modelName=${e} searchClause=${JSON.stringify(t)}`),this.getModels(e).destroy({where:t}).then(e=>e>0?{status:!0,data:e}:{status:!1,errMessage:"Data not found"}).catch(this.errHandler)}}exports.CRUDService=CRUDService,exports.default=CRUDService;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9jcnVkLXNlcnZpY2UudHMiXSwibmFtZXMiOlsic2VxdWVsaXplX3NlcnZpY2VfMSIsInJlcXVpcmUiLCJsb2ciLCJUQUciLCJDUlVEU2VydmljZSIsIltvYmplY3QgT2JqZWN0XSIsIm5hbWUiLCJkZWZhdWx0IiwiZ2V0SW5zdGFuY2UiLCJtb2RlbHMiLCJzZXF1ZWxpemUiLCJlcnIiLCJzdGF0dXMiLCJlcnJNZXNzYWdlIiwibWVzc2FnZSIsIm1vZGVsTmFtZSIsImRhdGEiLCJ2ZXJib3NlIiwiSlNPTiIsInN0cmluZ2lmeSIsInRoaXMiLCJnZXRNb2RlbHMiLCJjcmVhdGUiLCJPYmplY3QiLCJhc3NpZ24iLCJpZCIsInRoZW4iLCJjcmVhdGVkRGF0YSIsImdldCIsInBsYWluIiwiY2F0Y2giLCJlcnJIYW5kbGVyIiwic2VhcmNoQ2xhdXNlIiwiZmluZEFsbCIsIndoZXJlIiwicmVhZERhdGEiLCJtYXAiLCJmaW5kT25lIiwicXVlcnkiLCJnZXRTZXF1ZWxpemUiLCJ0eXBlIiwiUXVlcnlUeXBlcyIsIlNFTEVDVCIsInJlc3VsdCIsInJhd1JlYWRRdWVyeSIsInJlc3AiLCJsZW5ndGgiLCJ1cGRhdGUiLCJzcHJlYWQiLCJjb3VudCIsImRlc3Ryb3kiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoib0VBQUEsTUFBQUEsb0JBQUFDLFFBQUEsdUJBR0EsSUFBSUMsSUFBTUQsUUFBUSxVQUVsQixNQUFNRSxJQUFNLGNBRVosTUFBQUMsWUFDWUMsVUFBV0MsR0FDbkIsT0FBT04sb0JBQUFPLFFBQWlCQyxjQUFjQyxPQUFPSCxHQUdyQ0QsZUFDUixPQUFPTCxvQkFBQU8sUUFBaUJDLGNBQWNFLFVBRzlCTCxXQUFZTSxHQUNwQixHQUFJQSxFQUFJTCxLQUNOLE1BQU8sQ0FBRU0sUUFBUSxFQUFPQyxXQUFZRixFQUFJRyxTQUV4QyxNQUFNSCxFQUlWTixPQUE2QlUsRUFBbUJDLEdBRTlDLE9BREFkLElBQUllLFFBQVFkLDJCQUE0QlksVUFBa0JHLEtBQUtDLFVBQVVILE1BQ2pFSSxLQUFLQyxVQUFVTixHQUE4Q08sT0FBT0MsT0FBT0MsT0FBT1IsRUFBTSxDQUFFUyxHQUFJLFFBQVNDLEtBQUtDLElBQzNHLENBQUVmLFFBQVEsRUFBTUksS0FBTVcsRUFBWUMsSUFBSSxDQUFFQyxPQUFPLE9BQ3JEQyxNQUFNVixLQUFLVyxZQVFoQjFCLEtBQTRCVSxFQUFtQmlCLEdBRTdDLE9BREE5QixJQUFJZSxRQUFRZCx5QkFBMEJZLGtCQUEwQkcsS0FBS0MsVUFBVWEsTUFDdkVaLEtBQUtDLFVBQVVOLEdBQThDa0IsUUFBUSxDQUFFQyxNQUFPRixJQUFnQk4sS0FBS1MsSUFDbEcsQ0FBRXZCLFFBQVEsRUFBTUksS0FBTW1CLEVBQVNDLElBQUlwQixHQUFRQSxFQUFLWSxJQUFJLENBQUVDLE9BQU8sUUFDbkVDLE1BQU1WLEtBQUtXLFlBR2hCMUIsUUFBK0JVLEVBQW1CaUIsR0FDaEQsT0FBUVosS0FBS0MsVUFBVU4sR0FBOENzQixRQUFRLENBQUVILE1BQU9GLElBQWdCTixLQUFLUyxHQUNyR0EsRUFDSyxDQUFFdkIsUUFBUSxFQUFNSSxLQUFNbUIsRUFBU1AsSUFBSSxDQUFFQyxPQUFPLEtBRTVDLENBQUVqQixRQUFRLEVBQU9DLFdBQVksbUJBRXJDaUIsTUFBTVYsS0FBS1csWUFHaEIxQixhQUFjaUMsR0FDWixPQUFPbEIsS0FBS21CLGVBQWVELE1BQU1BLEVBQU8sQ0FBRUUsS0FBTXBCLEtBQUttQixlQUFlRSxXQUFXQyxTQUFVaEIsS0FBS2lCLElBQ3JGLENBQUUvQixRQUFRLEVBQU1JLEtBQU0yQixLQUlqQ3RDLGdCQUFpQmlDLEdBQ2YsT0FBT2xCLEtBQUt3QixhQUFhTixHQUFPWixLQUFLbUIsR0FDL0JBLEVBQUtqQyxRQUFVaUMsRUFBSzdCLEtBQ2pCNkIsRUFBSzdCLEtBQUs4QixPQUdOLENBQUVsQyxRQUFRLEVBQU1JLEtBQU02QixFQUFLN0IsS0FBSyxJQUZoQyxDQUFFSixRQUFRLEVBQU9DLFdBQVksbUJBSy9CZ0MsR0FLYnhDLE9BQThCVSxFQUFtQkMsRUFBa0JnQixHQUVqRSxPQURBOUIsSUFBSWUsUUFBUWQsMkJBQTRCWSxVQUFrQkcsS0FBS0MsVUFBVUgsTUFDakVJLEtBQUtDLFVBQVVOLEdBQ3BCZ0MsT0FBTy9CLEVBQU0sQ0FBRWtCLE1BQU9GLElBQXVCZ0IsT0FBUUMsR0FDaERBLEVBQVEsRUFDSCxDQUFFckMsUUFBUSxFQUFNSSxLQUFNaUMsR0FFdEIsQ0FBRXJDLFFBQVEsRUFBT0MsV0FBWSxtQkFFckNpQixNQUFNVixLQUFLVyxZQUdsQjFCLE9BQThCVSxFQUFtQmlCLEdBRS9DLE9BREE5QixJQUFJZSxRQUFRZCwyQkFBNEJZLGtCQUEwQkcsS0FBS0MsVUFBVWEsTUFDekVaLEtBQUtDLFVBQVVOLEdBQ3BCbUMsUUFBUSxDQUFFaEIsTUFBT0YsSUFBdUJOLEtBQU11QixHQUN6Q0EsRUFBUSxFQUNILENBQUVyQyxRQUFRLEVBQU1JLEtBQU1pQyxHQUV0QixDQUFFckMsUUFBUSxFQUFPQyxXQUFZLG1CQUVyQ2lCLE1BQU1WLEtBQUtXLGFBdkZwQm9CLFFBQUEvQyxZQUFBQSxZQTJGQStDLFFBQUE1QyxRQUFlSCIsImZpbGUiOiJzZXJ2aWNlcy9jcnVkLXNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2VxdWVsaXplU2VydmljZSBmcm9tICcuL3NlcXVlbGl6ZS1zZXJ2aWNlJ1xuaW1wb3J0IHsgTW9kZWwsIEluc3RhbmNlLCBXaGVyZU9wdGlvbnMsIFVwZGF0ZU9wdGlvbnMgfSBmcm9tICdzZXF1ZWxpemUnXG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gJ2JsdWViaXJkJ1xubGV0IGxvZyA9IHJlcXVpcmUoJ25wbWxvZycpXG5cbmNvbnN0IFRBRyA9ICdCYXNlU2VydmljZSdcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENSVURTZXJ2aWNlIHtcbiAgcHJvdGVjdGVkIGdldE1vZGVscyAobmFtZSkge1xuICAgIHJldHVybiBTZXF1ZWxpemVTZXJ2aWNlLmdldEluc3RhbmNlKCkubW9kZWxzW25hbWVdXG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VxdWVsaXplICgpIHtcbiAgICByZXR1cm4gU2VxdWVsaXplU2VydmljZS5nZXRJbnN0YW5jZSgpLnNlcXVlbGl6ZVxuICB9XG5cbiAgcHJvdGVjdGVkIGVyckhhbmRsZXIgKGVycikge1xuICAgIGlmIChlcnIubmFtZSkge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogZXJyLm1lc3NhZ2UgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBlcnJcbiAgICB9XG4gIH1cblxuICBjcmVhdGU8VCBleHRlbmRzIEJhc2VNb2RlbD4gKG1vZGVsTmFtZTogc3RyaW5nLCBkYXRhOiBQYXJ0aWFsPFQ+KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPFQ+PiB7XG4gICAgbG9nLnZlcmJvc2UoVEFHLCBgY3JlYXRlKCk6IG1vZGVsTmFtZT0ke21vZGVsTmFtZX0gZGF0YT0ke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApXG4gICAgcmV0dXJuICh0aGlzLmdldE1vZGVscyhtb2RlbE5hbWUpIGFzIE1vZGVsPEluc3RhbmNlPFQ+LCBQYXJ0aWFsPFQ+PikuY3JlYXRlKE9iamVjdC5hc3NpZ24oZGF0YSwgeyBpZDogbnVsbCB9KSkudGhlbihjcmVhdGVkRGF0YSA9PiB7XG4gICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IGNyZWF0ZWREYXRhLmdldCh7IHBsYWluOiB0cnVlIH0pIH1cbiAgICB9KS5jYXRjaCh0aGlzLmVyckhhbmRsZXIpXG4gIH1cblxuICAvLyBJZiB0aGVyZSdzIGRhdGEgdG8gYmUgcmVhZDpcbiAgLy8ge3N0YXR1czogdHJ1ZSwgZGF0YTogW119XG4gIC8vXG4gIC8vIElmIHRoZXJlJ3Mgbm8gZGF0YTpcbiAgLy8ge3N0YXR1czogZmFsc2UsIGVyckNvZGU6IC4uLiwgZXJyTWVzc2FnZTogLi4uLCBlcnJEYXRhfVxuICByZWFkIDxUIGV4dGVuZHMgQmFzZU1vZGVsPiAobW9kZWxOYW1lOiBzdHJpbmcsIHNlYXJjaENsYXVzZTogV2hlcmVPcHRpb25zPFQ+KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPFRbXT4+IHtcbiAgICBsb2cudmVyYm9zZShUQUcsIGByZWFkKCk6IG1vZGVsTmFtZT0ke21vZGVsTmFtZX0gc2VhcmNoQ2xhdXNlPSR7SlNPTi5zdHJpbmdpZnkoc2VhcmNoQ2xhdXNlKX1gKVxuICAgIHJldHVybiAodGhpcy5nZXRNb2RlbHMobW9kZWxOYW1lKSBhcyBNb2RlbDxJbnN0YW5jZTxUPiwgUGFydGlhbDxUPj4pLmZpbmRBbGwoeyB3aGVyZTogc2VhcmNoQ2xhdXNlIH0pLnRoZW4ocmVhZERhdGEgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZWFkRGF0YS5tYXAoZGF0YSA9PiBkYXRhLmdldCh7IHBsYWluOiB0cnVlIH0pKSB9XG4gICAgfSkuY2F0Y2godGhpcy5lcnJIYW5kbGVyKVxuICB9XG5cbiAgcmVhZE9uZSA8VCBleHRlbmRzIEJhc2VNb2RlbD4gKG1vZGVsTmFtZTogc3RyaW5nLCBzZWFyY2hDbGF1c2U6IFdoZXJlT3B0aW9uczxUPik6IFByb21pc2U8TkNSZXNwb25zZTxUPj4ge1xuICAgIHJldHVybiAodGhpcy5nZXRNb2RlbHMobW9kZWxOYW1lKSBhcyBNb2RlbDxJbnN0YW5jZTxUPiwgUGFydGlhbDxUPj4pLmZpbmRPbmUoeyB3aGVyZTogc2VhcmNoQ2xhdXNlIH0pLnRoZW4ocmVhZERhdGEgPT4ge1xuICAgICAgaWYgKHJlYWREYXRhKSB7XG4gICAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSwgZGF0YTogcmVhZERhdGEuZ2V0KHsgcGxhaW46IHRydWUgfSkgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ0RhdGEgbm90IGZvdW5kJyB9XG4gICAgICB9XG4gICAgfSkuY2F0Y2godGhpcy5lcnJIYW5kbGVyKVxuICB9XG5cbiAgcmF3UmVhZFF1ZXJ5IChxdWVyeSk6IFByb21pc2U8TkNSZXNwb25zZTxhbnlbXT4+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRTZXF1ZWxpemUoKS5xdWVyeShxdWVyeSwgeyB0eXBlOiB0aGlzLmdldFNlcXVlbGl6ZSgpLlF1ZXJ5VHlwZXMuU0VMRUNUIH0pLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgIHJldHVybiB7IHN0YXR1czogdHJ1ZSwgZGF0YTogcmVzdWx0IH1cbiAgICB9KVxuICB9XG5cbiAgcmF3UmVhZE9uZVF1ZXJ5IChxdWVyeSk6IFByb21pc2U8TkNSZXNwb25zZTxhbnk+PiB7XG4gICAgcmV0dXJuIHRoaXMucmF3UmVhZFF1ZXJ5KHF1ZXJ5KS50aGVuKHJlc3AgPT4ge1xuICAgICAgaWYgKHJlc3Auc3RhdHVzICYmIHJlc3AuZGF0YSkge1xuICAgICAgICBpZiAoIXJlc3AuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnRGF0YSBub3QgZm91bmQhJyB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZXNwLmRhdGFbMF0gfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVzcFxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICB1cGRhdGUgPFQgZXh0ZW5kcyBCYXNlTW9kZWw+IChtb2RlbE5hbWU6IHN0cmluZywgZGF0YTogUGFydGlhbDxUPiwgc2VhcmNoQ2xhdXNlOiBXaGVyZU9wdGlvbnM8VD4pOiBQcm9taXNlPE5DUmVzcG9uc2U8bnVtYmVyPj4ge1xuICAgIGxvZy52ZXJib3NlKFRBRywgYHVwZGF0ZSgpOiBtb2RlbE5hbWU9JHttb2RlbE5hbWV9IGRhdGE9JHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKVxuICAgIHJldHVybiAodGhpcy5nZXRNb2RlbHMobW9kZWxOYW1lKSBhcyBNb2RlbDxJbnN0YW5jZTxUPiwgUGFydGlhbDxUPj4pXG4gICAgICAudXBkYXRlKGRhdGEsIHsgd2hlcmU6IHNlYXJjaENsYXVzZSBhcyBhbnkgfSkuc3ByZWFkKChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IGNvdW50IH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnRGF0YSBub3QgZm91bmQnIH1cbiAgICAgICAgfVxuICAgICAgfSkuY2F0Y2godGhpcy5lcnJIYW5kbGVyKVxuICB9XG5cbiAgZGVsZXRlIDxUIGV4dGVuZHMgQmFzZU1vZGVsPiAobW9kZWxOYW1lOiBzdHJpbmcsIHNlYXJjaENsYXVzZTogV2hlcmVPcHRpb25zPFQ+KTogUHJvbWlzZTxOQ1Jlc3BvbnNlPG51bWJlcj4+IHtcbiAgICBsb2cudmVyYm9zZShUQUcsIGBkZWxldGUoKTogbW9kZWxOYW1lPSR7bW9kZWxOYW1lfSBzZWFyY2hDbGF1c2U9JHtKU09OLnN0cmluZ2lmeShzZWFyY2hDbGF1c2UpfWApXG4gICAgcmV0dXJuICh0aGlzLmdldE1vZGVscyhtb2RlbE5hbWUpIGFzIE1vZGVsPEluc3RhbmNlPFQ+LCBQYXJ0aWFsPFQ+PilcbiAgICAgIC5kZXN0cm95KHsgd2hlcmU6IHNlYXJjaENsYXVzZSBhcyBhbnkgfSkudGhlbigoY291bnQ6IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiBjb3VudCB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ0RhdGEgbm90IGZvdW5kJyB9XG4gICAgICAgIH1cbiAgICAgIH0pLmNhdGNoKHRoaXMuZXJySGFuZGxlcilcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDUlVEU2VydmljZVxuIl19
